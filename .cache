{"lib/require.coffee":{"code":"var File, moduleManager;\n\nFunction.prototype.property = function(prop, desc) {\n  return Object.defineProperty(this.prototype, prop, desc);\n};\n\nmoduleManager = {\n  File: File = (function() {\n    function File(manager, absPath) {\n      this.manager = manager;\n      this.absPath = absPath;\n      if (this.manager.files[this.absPath] == null) {\n        throw new Error(\"file does not exist: \" + this.absPath);\n      }\n    }\n\n    File.prototype.read = function() {\n      return this.manager.files[this.absPath];\n    };\n\n    return File;\n\n  })(),\n  modules: {},\n  files: {},\n  module: function(name, closure) {\n    return this.modules[name] = {\n      closure: closure,\n      instance: null\n    };\n  },\n  text: function(name, content) {\n    return this.files[name] = content;\n  },\n  index: function() {\n    this.getLocation();\n    return this[\"import\"]('/index');\n  },\n  getLocation: function() {\n    var script, scripts;\n    if (self.document != null) {\n      scripts = document.getElementsByTagName('script');\n      script = scripts[scripts.length - 1];\n      this.script = script.src;\n    } else {\n      this.script = self.location.href;\n    }\n    return this.location = this.script.slice(0, this.script.lastIndexOf('/') + 1);\n  },\n  abspath: function(fromName, pathName) {\n    var base, baseName, path;\n    if (pathName === '.') {\n      pathName = '';\n    }\n    baseName = fromName.split('/');\n    baseName.pop();\n    baseName = baseName.join('/');\n    if (pathName[0] === '/') {\n      return pathName;\n    } else {\n      path = pathName.split('/');\n      if (baseName === '/') {\n        base = [''];\n      } else {\n        base = baseName.split('/');\n      }\n      while (base.length > 0 && path.length > 0 && path[0] === '..') {\n        base.pop();\n        path.shift();\n      }\n      if (base.length === 0 || path.length === 0 || base[0] !== '') {\n        throw new Error(\"Invalid path: \" + (base.join('/')) + \"/\" + (path.join('/')));\n      }\n      return (base.join('/')) + \"/\" + (path.join('/'));\n    }\n  },\n  \"import\": function(moduleName) {\n    var exports, module, require, sys;\n    if (moduleName != null) {\n      module = this.modules[moduleName];\n      if (module === void 0) {\n        module = this.modules[moduleName + '/index'];\n        if (module != null) {\n          moduleName = moduleName + '/index';\n        } else {\n          throw new Error('Module not found: ' + moduleName);\n        }\n      }\n      if (module.instance === null) {\n        require = (function(_this) {\n          return function(requirePath) {\n            var path;\n            path = _this.abspath(moduleName, requirePath);\n            return _this[\"import\"](path);\n          };\n        })(this);\n        exports = {};\n        sys = {\n          script: this.script,\n          location: this.location,\n          \"import\": (function(_this) {\n            return function(requirePath) {\n              var path;\n              path = _this.abspath(moduleName, requirePath);\n              return _this[\"import\"](path);\n            };\n          })(this),\n          file: (function(_this) {\n            return function(path) {\n              path = _this.abspath(moduleName, path);\n              return new _this.File(_this, path);\n            };\n          })(this),\n          File: File\n        };\n        module.closure(exports, sys);\n        if (exports.index != null) {\n          module.instance = exports.index;\n        } else {\n          module.instance = exports;\n        }\n      }\n      return module.instance;\n    } else {\n      throw new Error('no module name provided');\n    }\n  }\n};\n","map":{"version":3,"file":"","sourceRoot":"","sources":["lib/require.coffee"],"names":[],"mappings":"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","sourcesContent":["Function::property = (prop, desc) ->\n    Object.defineProperty @prototype, prop, desc\n\nmoduleManager =\n    File: class File\n        constructor: (@manager, @absPath) ->\n            if not @manager.files[@absPath]?\n                throw new Error(\"file does not exist: #{@absPath}\")\n        read: -> @manager.files[@absPath]\n\n    modules: {}\n    files: {}\n    module: (name, closure) ->\n        @modules[name] =\n            closure: closure\n            instance: null\n\n    text: (name, content) ->\n        @files[name] = content\n\n    index: ->\n        @getLocation()\n        @import('/index')\n\n    getLocation: ->\n        if self.document?\n            scripts = document.getElementsByTagName 'script'\n            script = scripts[scripts.length-1]\n            @script = script.src\n        else\n            @script = self.location.href\n\n        @location = @script[...@script.lastIndexOf('/')+1]\n\n    abspath: (fromName, pathName) ->\n        if pathName == '.'\n            pathName = ''\n\n        baseName = fromName.split('/')\n        baseName.pop()\n        baseName = baseName.join('/')\n\n        if pathName[0] == '/'\n            return pathName\n        else\n            path = pathName.split '/'\n            if baseName == '/'\n                base = ['']\n            else\n                base = baseName.split '/'\n\n            while base.length > 0 and path.length > 0 and path[0] == '..'\n                base.pop()\n                path.shift()\n\n            if base.length == 0 || path.length == 0 || base[0] != ''\n                throw new Error(\"Invalid path: #{base.join '/'}/#{path.join '/'}\")\n            return \"#{base.join('/')}/#{path.join('/')}\"\n    \n    import: (moduleName) ->\n        if moduleName?\n            module = @modules[moduleName]\n\n            if module == undefined\n                module = @modules[moduleName+'/index']\n                if module?\n                    moduleName = moduleName+'/index'\n                else\n                    throw new Error('Module not found: ' + moduleName)\n            \n            if module.instance == null\n                require = (requirePath) =>\n                    path = @abspath(moduleName, requirePath)\n                    return @import(path)\n\n                exports = {}\n                sys = {\n                    script: @script\n                    location: @location\n                    import: (requirePath) =>\n                        path = @abspath(moduleName, requirePath)\n                        return @import(path)\n                    file: (path) =>\n                        path = @abspath(moduleName, path)\n                        return new @File(@, path)\n                    File: File\n                }\n                module.closure(exports, sys)\n                if exports.index?\n                    module.instance = exports.index\n                else\n                    module.instance = exports\n\n            return module.instance\n        else\n            throw new Error('no module name provided')\n"]},"mtime":1504351840182},"coffee\\index.coffee":{"code":"var Game;\n\nGame = sys[\"import\"]('game');\n\n$(function() {\n  var connection, game;\n  connection = new WebSocket(\"ws://\" + document.location.hostname + \":2503/\");\n  game = new Game();\n  return connection.onmessage = function(arg) {\n    var data;\n    data = arg.data;\n    data = JSON.parse(data);\n    switch (data.type) {\n      case 'info':\n        return game.info(data.data);\n      case 'update':\n        return game.update(data.data);\n    }\n  };\n});\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\index.coffee"],"names":[],"mappings":"AAAA,IAAA;;AAAA,IAAA,GAAO,GAAG,EAAC,MAAD,EAAH,CAAW,MAAX;;AAEP,CAAA,CAAE,SAAA;AACD,MAAA;EAAA,UAAA,GAAa,IAAI,SAAJ,CAAc,OAAA,GAAQ,QAAQ,CAAC,QAAQ,CAAC,QAA1B,GAAmC,QAAjD;EAEb,IAAA,GAAO,IAAI,IAAJ,CAAA;SAEP,UAAU,CAAC,SAAX,GAAuB,SAAC,GAAD;AACtB,QAAA;IADwB,OAAD;IACvB,IAAA,GAAO,IAAI,CAAC,KAAL,CAAW,IAAX;AACP,YAAO,IAAI,CAAC,IAAZ;AAAA,WACM,MADN;eAEE,IAAI,CAAC,IAAL,CAAU,IAAI,CAAC,IAAf;AAFF,WAGM,QAHN;eAIE,IAAI,CAAC,MAAL,CAAY,IAAI,CAAC,IAAjB;AAJF;EAFsB;AALtB,CAAF","sourcesContent":["Game = sys.import('game')\r\n\r\n$ ->\r\n\tconnection = new WebSocket(\"ws://#{document.location.hostname}:2503/\")\r\n\r\n\tgame = new Game()\r\n\r\n\tconnection.onmessage = ({data}) ->\r\n\t\tdata = JSON.parse(data)\r\n\t\tswitch data.type\r\n\t\t\twhen 'info'\r\n\t\t\t\tgame.info(data.data)\r\n\t\t\twhen 'update'\r\n\t\t\t\tgame.update(data.data)"]},"mtime":1504428513400,"isModule":true},"coffee\\game.coffee":{"code":"var Game, Player,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nPlayer = sys[\"import\"]('player');\n\nexports.index = Game = (function() {\n  function Game() {\n    this.raf = bind(this.raf, this);\n    var mapdiv;\n    this.sidebar = $('<div class=\"sidebar\"></div>').appendTo('body');\n    $('<h1 class=\"allies\">My Team</h1>').appendTo(this.sidebar);\n    this.alliesAlive = $('<div class=\"players allies\"></div>').appendTo(this.sidebar);\n    this.alliesDead = $('<div class=\"players allies\"></div>').appendTo(this.sidebar);\n    $('<h1 class=\"enemies\">Enemies</h1>').appendTo(this.sidebar);\n    this.enemiesAlive = $('<div class=\"players enemies\"></div>').appendTo(this.sidebar);\n    this.enemiesDead = $('<div class=\"players enemies\"></div>').appendTo(this.sidebar);\n    mapdiv = $('<div class=\"map\"></div>').appendTo('body');\n    this.canvas = $('<canvas></canvas>').appendTo(mapdiv)[0];\n    this.ctx = this.canvas.getContext('2d');\n    this.playersByID = {};\n    this.playersByShipID = {};\n    this.players = [];\n    this.raf();\n  }\n\n  Game.prototype.info = function(data) {\n    var i, len, player, playerData, ref;\n    this.playersByID = {};\n    this.playersByShipID = {};\n    this.players = [];\n    if (data.inMatch) {\n      this.inMatch = true;\n      this.mapWidth = data.map.border.high[0] - data.map.border.low[0];\n      this.mapHeight = data.map.border.high[2] - data.map.border.low[2];\n      this.mapX = data.map.border.low[0];\n      this.mapY = data.map.border.low[2];\n      ref = data.players;\n      for (i = 0, len = ref.length; i < len; i++) {\n        playerData = ref[i];\n        if (playerData.team === 'ally') {\n          player = new Player(this, playerData, this.alliesAlive, this.alliesDead);\n        } else {\n          player = new Player(this, playerData, this.enemiesAlive, this.enemiesDead);\n        }\n        if (player.self) {\n          this.self = player;\n        }\n        this.players.push(player);\n        this.playersByID[player.id] = player;\n        this.playersByShipID[playerData.ship.id] = player;\n      }\n    } else {\n      this.inMatch = false;\n      this.self = null;\n      this.alliesDead.empty();\n      this.alliesAlive.empty();\n      this.enemiesDead.empty();\n      this.enemiesAlive.empty();\n    }\n  };\n\n  Game.prototype.update = function(data) {\n    var i, item, len, player;\n    for (i = 0, len = data.length; i < len; i++) {\n      item = data[i];\n      player = this.playersByID[item.id];\n      if (player != null) {\n        player.update(item);\n      }\n    }\n  };\n\n  Game.prototype.drawPlayers = function() {\n    var i, j, len, len1, player, ref, ref1, target, targetId;\n    ref = this.players;\n    for (i = 0, len = ref.length; i < len; i++) {\n      player = ref[i];\n      player.targeted = false;\n    }\n    targetId = this.self.getTargetId();\n    target = this.playersByShipID[targetId];\n    if (target != null) {\n      target.targeted = true;\n      target.drawTargetMarker();\n    }\n    ref1 = this.players;\n    for (j = 0, len1 = ref1.length; j < len1; j++) {\n      player = ref1[j];\n      player.draw();\n    }\n  };\n\n  Game.prototype.drawBorder = function() {\n    var x0, x1, y0, y1;\n    x0 = this.drawAreaX;\n    y0 = this.drawAreaY;\n    x1 = x0 + this.drawAreaSize;\n    y1 = y0 + this.drawAreaSize;\n    this.ctx.strokeStyle = 'rgba(255,255,255,0.25)';\n    this.ctx.beginPath();\n    this.ctx.moveTo(x0, y0);\n    this.ctx.lineTo(x1, y0);\n    this.ctx.lineTo(x1, y1);\n    this.ctx.lineTo(x0, y1);\n    this.ctx.closePath();\n    return this.ctx.stroke();\n  };\n\n  Game.prototype.raf = function() {\n    var height, width;\n    width = this.canvas.clientWidth;\n    height = this.canvas.clientHeight;\n    if (width !== this.canvas.width || height !== this.canvas.height) {\n      this.drawAreaSize = Math.min(width, height);\n      this.drawAreaX = (width / 2) - this.drawAreaSize / 2;\n      this.drawAreaY = (height / 2) - this.drawAreaSize / 2;\n      this.canvas.width = width;\n      this.canvas.height = height;\n    }\n    this.width = width;\n    this.height = height;\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    if (this.inMatch) {\n      this.drawBorder();\n      this.drawPlayers();\n    }\n    return requestAnimationFrame(this.raf);\n  };\n\n  Game.prototype.getDrawX = function(x) {\n    x = (x - this.mapX) / this.mapWidth;\n    x = this.drawAreaX + x * this.drawAreaSize;\n    return x;\n  };\n\n  Game.prototype.getDrawY = function(y) {\n    y = 1.0 - (y - this.mapY) / this.mapHeight;\n    y = this.drawAreaY + y * this.drawAreaSize;\n    return y;\n  };\n\n  return Game;\n\n})();\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\game.coffee"],"names":[],"mappings":"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","sourcesContent":["Player = sys.import 'player'\r\n\r\nexports.index = class Game\r\n\tconstructor: ->\r\n\t\t@sidebar = $('<div class=\"sidebar\"></div>').appendTo('body')\r\n\r\n\t\t$('<h1 class=\"allies\">My Team</h1>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@alliesAlive = $('<div class=\"players allies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@alliesDead = $('<div class=\"players allies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\r\n\t\t$('<h1 class=\"enemies\">Enemies</h1>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@enemiesAlive = $('<div class=\"players enemies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@enemiesDead = $('<div class=\"players enemies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\r\n\t\tmapdiv = $('<div class=\"map\"></div>').appendTo('body')\r\n\t\t@canvas = $('<canvas></canvas>').appendTo(mapdiv)[0]\r\n\t\t@ctx = @canvas.getContext('2d')\r\n\r\n\t\t@playersByID = {}\r\n\t\t@playersByShipID = {}\r\n\t\t@players = []\r\n\r\n\t\t@raf()\r\n\r\n\tinfo: (data) ->\r\n\t\t@playersByID = {}\r\n\t\t@playersByShipID = {}\r\n\t\t@players = []\r\n\t\tif data.inMatch\r\n\t\t\t@inMatch = true\r\n\t\t\t@mapWidth = data.map.border.high[0] - data.map.border.low[0]\r\n\t\t\t@mapHeight = data.map.border.high[2] - data.map.border.low[2]\r\n\t\t\t@mapX = data.map.border.low[0]\r\n\t\t\t@mapY = data.map.border.low[2]\r\n\r\n\t\t\tfor playerData in data.players\r\n\t\t\t\tif playerData.team == 'ally'\r\n\t\t\t\t\tplayer = new Player(@, playerData, @alliesAlive, @alliesDead)\r\n\t\t\t\telse\r\n\t\t\t\t\tplayer = new Player(@, playerData, @enemiesAlive, @enemiesDead)\r\n\r\n\t\t\t\tif player.self\r\n\t\t\t\t\t@self = player\r\n\r\n\t\t\t\t@players.push(player)\r\n\t\t\t\t@playersByID[player.id] = player\r\n\t\t\t\t@playersByShipID[playerData.ship.id] = player\r\n\t\telse\r\n\t\t\t@inMatch = false\r\n\t\t\t@self = null\r\n\t\t\t@alliesDead.empty()\r\n\t\t\t@alliesAlive.empty()\r\n\t\t\t@enemiesDead.empty()\r\n\t\t\t@enemiesAlive.empty()\r\n\t\treturn\r\n\r\n\tupdate: (data) ->\r\n\t\tfor item in data\r\n\t\t\tplayer = @playersByID[item.id]\r\n\t\t\tif player?\r\n\t\t\t\tplayer.update(item)\r\n\t\treturn\r\n\r\n\tdrawPlayers: ->\r\n\t\tfor player in @players\r\n\t\t\tplayer.targeted = false\r\n\r\n\t\ttargetId = @self.getTargetId()\r\n\t\ttarget = @playersByShipID[targetId]\r\n\t\tif target?\r\n\t\t\ttarget.targeted = true\r\n\t\t\ttarget.drawTargetMarker()\r\n\r\n\t\tfor player in @players\r\n\t\t\tplayer.draw()\r\n\t\treturn\r\n\r\n\tdrawBorder: ->\r\n\t\tx0 = @drawAreaX\r\n\t\ty0 = @drawAreaY\r\n\t\tx1 = x0 + @drawAreaSize\r\n\t\ty1 = y0 + @drawAreaSize\r\n\r\n\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.25)'\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.moveTo(x0, y0)\r\n\t\t@ctx.lineTo(x1, y0)\r\n\t\t@ctx.lineTo(x1, y1)\r\n\t\t@ctx.lineTo(x0, y1)\r\n\t\t@ctx.closePath()\r\n\t\t@ctx.stroke()\r\n\r\n\traf: =>\r\n\t\twidth = @canvas.clientWidth\r\n\t\theight = @canvas.clientHeight\r\n\r\n\t\tif width != @canvas.width or height != @canvas.height\r\n\t\t\t@drawAreaSize = Math.min(width, height)\r\n\t\t\t@drawAreaX = (width/2) - @drawAreaSize/2\r\n\t\t\t@drawAreaY = (height/2) - @drawAreaSize/2\r\n\r\n\t\t\t@canvas.width = width\r\n\t\t\t@canvas.height = height\r\n\r\n\t\t@width = width\r\n\t\t@height = height\r\n\r\n\t\t@ctx.clearRect(0, 0, @canvas.width, @canvas.height)\r\n\r\n\t\tif @inMatch\r\n\t\t\t@drawBorder()\r\n\t\t\t@drawPlayers()\r\n\r\n\t\trequestAnimationFrame(@raf)\r\n\r\n\tgetDrawX: (x) ->\r\n\t\tx = (x-@mapX)/@mapWidth\r\n\t\tx = @drawAreaX + x*@drawAreaSize\r\n\t\treturn x\r\n\r\n\tgetDrawY: (y) ->\r\n\t\ty = 1.0 - (y-@mapY)/@mapHeight\r\n\t\ty = @drawAreaY + y*@drawAreaSize\r\n\t\treturn y"]},"mtime":1504610305179,"isModule":true},"coffee\\player.coffee":{"code":"var Player, shapes;\n\nshapes = {\n  Cruiser: new Path2D('m -8,-4 v 8 h 3.8164062 l 3.72656255,-8 z m 9.7480469,0 -3.7265625,8 H 5 L 9,0 5,-4 Z'),\n  Battleship: new Path2D('m -8,-4 v 8 h 1.300781 l 3.726563,-8 z m 7.232422,0 -3.726563,8 h 2.373047 L 1.605469,-4 Z M 3.8125,-4 0.085938,4 H 5 L 9,0 5,-4 Z'),\n  Destroyer: new Path2D('M -5,-4 6,0 -5,4 v -8'),\n  AirCarrier: new Path2D('m -8,-4 v 3 H 1 V -4 Z M 3,-4 V 4 H 5 L 9,0 5,-4 Z M -8,1 V 4 H 1 V 1 Z'),\n  ship: new Path2D('M 9,0 5,4 H -8 V -4 H 5 Z'),\n  self: new Path2D('M -5,-4 6,0 -5,4 -3,0 -5,-4')\n};\n\nexports.index = Player = (function() {\n  function Player(game, info, aliveContainer, deadContainer) {\n    this.game = game;\n    this.info = info;\n    this.aliveContainer = aliveContainer;\n    this.deadContainer = deadContainer;\n    this.ctx = this.game.ctx;\n    this.id = this.info.id;\n    this.self = this.info.self;\n    this.alive = true;\n    this.div = $('<div class=\"player\"></div>').appendTo(this.aliveContainer);\n    $('<div class=\"name\"></div>').appendTo(this.div).text(this.info.name);\n    $('<div class=\"ship\"></div>').appendTo(this.div).text(this.info.ship.name);\n    this.speedDisplay = $('<div class=\"speed\"></div>').appendTo(this.div);\n  }\n\n  Player.prototype.getTargetId = function() {\n    if (this.data != null) {\n      return this.data.targeting;\n    }\n  };\n\n  Player.prototype.draw = function() {\n    var c, s, x, y;\n    if (this.data == null) {\n      return;\n    }\n    if (this.data.spotted == null) {\n      return;\n    }\n    x = this.game.getDrawX(this.data.position[0]);\n    y = this.game.getDrawY(this.data.position[2]);\n    s = Math.sin(this.data.dir);\n    c = Math.cos(this.data.dir);\n    if (this.self) {\n      return this.drawSelf(x, y, s, c);\n    } else {\n      return this.drawShip(x, y, s, c);\n    }\n  };\n\n  Player.prototype.drawTargetMarker = function() {\n    var c, q, s, spacing, span, x, y;\n    if (this.data != null) {\n      x = this.game.getDrawX(this.data.position[0]);\n      y = this.game.getDrawY(this.data.position[2]);\n      s = Math.sin(this.data.dir);\n      c = Math.cos(this.data.dir);\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, y);\n      this.ctx.lineTo(x + s * 2000, y - c * 2000);\n      this.ctx.stroke();\n      spacing = Math.PI / 10;\n      span = Math.PI / 4 - spacing;\n      q = Math.PI / 2;\n      this.ctx.save();\n      this.ctx.translate(x, y);\n      this.ctx.rotate(this.data.dir);\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.8)';\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, -span, span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, q - span, q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, 2 * q - span, 2 * q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, 3 * q - span, 3 * q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(14, +14);\n      this.ctx.lineTo(21, +21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(-14, -14);\n      this.ctx.lineTo(-21, -21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(+14, -14);\n      this.ctx.lineTo(+21, -21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(-14, +14);\n      this.ctx.lineTo(-21, +21);\n      this.ctx.stroke();\n      return this.ctx.restore();\n    }\n  };\n\n  Player.prototype.drawSelf = function(x, y, s, c) {\n    var color, shape;\n    if (this.data.alive) {\n      color = 'white';\n    } else {\n      color = 'black';\n    }\n    this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n    this.ctx.beginPath();\n    this.ctx.moveTo(x, y);\n    this.ctx.lineTo(x + s * 2000, y - c * 2000);\n    this.ctx.stroke();\n    this.ctx.fillStyle = color;\n    shape = shapes.self;\n    this.ctx.save();\n    this.ctx.translate(x, y);\n    this.ctx.rotate(this.data.dir - Math.PI / 2);\n    this.ctx.fill(shape);\n    return this.ctx.restore();\n  };\n\n  Player.prototype.drawShip = function(x, y, s, c) {\n    var color, shape;\n    if (this.data.alive) {\n      if (this.info.team === 'ally') {\n        color = '#45e9af';\n      } else {\n        if (this.data.spotted) {\n          color = 'red';\n        } else {\n          color = '#ccc';\n        }\n      }\n    } else {\n      color = 'black';\n    }\n    this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n    this.ctx.beginPath();\n    this.ctx.moveTo(x, y);\n    this.ctx.lineTo(x + s * 30, y - c * 30);\n    this.ctx.stroke();\n    this.ctx.fillStyle = color;\n    shape = shapes[this.info.ship.type];\n    this.ctx.save();\n    this.ctx.translate(x, y);\n    this.ctx.rotate(this.data.dir - Math.PI / 2);\n    this.ctx.fill(shape);\n    this.ctx.restore();\n    this.ctx.save();\n    this.ctx.globalAlpha = 0.5;\n    this.ctx.textAlign = 'center';\n    this.ctx.font = '500 9px \"Nobile\"';\n    this.ctx.fillText(this.info.ship.short, Math.round(x), Math.round(y + 18));\n    return this.ctx.restore();\n  };\n\n  Player.prototype.died = function() {\n    this.div.addClass('dead');\n    return this.div.appendTo(this.deadContainer);\n  };\n\n  Player.prototype.update = function(data) {\n    this.data = data;\n    if (!this.data.alive) {\n      this.alive = false;\n      this.died();\n    }\n    if (this.data.visible) {\n      this.speedDisplay.removeClass('hidden');\n    } else {\n      this.speedDisplay.addClass('hidden');\n    }\n    this.speedDisplay.text(this.data.speed.toFixed(0) + ' kts');\n    if (this.targeted) {\n      return this.div.addClass('targeted');\n    } else {\n      return this.div.removeClass('targeted');\n    }\n  };\n\n  return Player;\n\n})();\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\player.coffee"],"names":[],"mappings":"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","sourcesContent":["shapes =\r\n\tCruiser: new Path2D('m -8,-4 v 8 h 3.8164062 l 3.72656255,-8 z m 9.7480469,0 -3.7265625,8 H 5 L 9,0 5,-4 Z')\r\n\tBattleship: new Path2D('m -8,-4 v 8 h 1.300781 l 3.726563,-8 z m 7.232422,0 -3.726563,8 h 2.373047 L 1.605469,-4 Z M 3.8125,-4 0.085938,4 H 5 L 9,0 5,-4 Z')\r\n\tDestroyer: new Path2D('M -5,-4 6,0 -5,4 v -8')\r\n\tAirCarrier: new Path2D('m -8,-4 v 3 H 1 V -4 Z M 3,-4 V 4 H 5 L 9,0 5,-4 Z M -8,1 V 4 H 1 V 1 Z')\r\n\tship: new Path2D('M 9,0 5,4 H -8 V -4 H 5 Z')\r\n\tself: new Path2D('M -5,-4 6,0 -5,4 -3,0 -5,-4')\r\n\r\nexports.index = class Player\r\n\tconstructor: (@game, @info, @aliveContainer, @deadContainer) ->\r\n\t\t@ctx = @game.ctx\r\n\t\t@id = @info.id\r\n\t\t@self = @info.self\r\n\t\t@alive = true\r\n\r\n\t\t@div = $('<div class=\"player\"></div>')\r\n\t\t\t.appendTo(@aliveContainer)\r\n\r\n\t\t$('<div class=\"name\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\t\t\t.text(@info.name)\r\n\r\n\t\t$('<div class=\"ship\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\t\t\t.text(@info.ship.name)\r\n\r\n\t\t@speedDisplay = $('<div class=\"speed\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\r\n\tgetTargetId: ->\r\n\t\tif @data?\r\n\t\t\treturn @data.targeting\r\n\r\n\tdraw: ->\r\n\t\tif not @data?\r\n\t\t\treturn\r\n\r\n\t\tif not @data.spotted?\r\n\t\t\treturn\r\n\r\n\t\tx = @game.getDrawX(@data.position[0])\r\n\t\ty = @game.getDrawY(@data.position[2])\r\n\t\ts = Math.sin(@data.dir)\r\n\t\tc = Math.cos(@data.dir)\r\n\r\n\t\tif @self\r\n\t\t\t@drawSelf(x, y, s, c)\r\n\t\telse\r\n\t\t\t@drawShip(x, y, s, c)\r\n\r\n\tdrawTargetMarker: ->\r\n\t\tif @data?\r\n\t\t\tx = @game.getDrawX(@data.position[0])\r\n\t\t\ty = @game.getDrawY(@data.position[2])\r\n\t\t\ts = Math.sin(@data.dir)\r\n\t\t\tc = Math.cos(@data.dir)\r\n\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x, y)\r\n\t\t\t@ctx.lineTo(x+s*2000, y-c*2000)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\tspacing = Math.PI/10\r\n\t\t\tspan = Math.PI/4 - spacing\r\n\t\t\tq = Math.PI/2\r\n\r\n\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.translate(x, y)\r\n\t\t\t@ctx.rotate(@data.dir)\r\n\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.8)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, -span, span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, q-span, q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, 2*q-span, 2*q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, 3*q-span, 3*q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(14, +14)\r\n\t\t\t@ctx.lineTo(21, +21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(-14, -14)\r\n\t\t\t@ctx.lineTo(-21, -21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(+14, -14)\r\n\t\t\t@ctx.lineTo(+21, -21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(-14, +14)\r\n\t\t\t@ctx.lineTo(-21, +21)\r\n\t\t\t@ctx.stroke()\r\n\t\t\t@ctx.restore()\r\n\r\n\tdrawSelf: (x, y, s, c) ->\r\n\t\tif @data.alive\r\n\t\t\tcolor = 'white'\r\n\t\telse\r\n\t\t\tcolor = 'black'\r\n\r\n\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.moveTo(x, y)\r\n\t\t@ctx.lineTo(x+s*2000, y-c*2000)\r\n\t\t@ctx.stroke()\r\n\r\n\t\t@ctx.fillStyle = color\r\n\t\tshape = shapes.self\r\n\t\t@ctx.save()\r\n\t\t@ctx.translate(x, y)\r\n\t\t@ctx.rotate(@data.dir - Math.PI/2)\r\n\t\t#@ctx.scale(10, 10)\r\n\t\t@ctx.fill(shape)\r\n\t\t@ctx.restore()\r\n\r\n\tdrawShip: (x, y, s, c) ->\r\n\t\tif @data.alive\r\n\t\t\tif @info.team == 'ally'\r\n\t\t\t\tcolor = '#45e9af'\r\n\t\t\telse\r\n\t\t\t\tif @data.spotted\r\n\t\t\t\t\tcolor = 'red'\r\n\t\t\t\telse\r\n\t\t\t\t\tcolor = '#ccc'\r\n\t\telse\r\n\t\t\tcolor = 'black'\r\n\r\n\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.moveTo(x, y)\r\n\t\t@ctx.lineTo(x+s*30, y-c*30)\r\n\t\t@ctx.stroke()\r\n\r\n\t\t@ctx.fillStyle = color\r\n\t\tshape = shapes[@info.ship.type]\r\n\t\t@ctx.save()\r\n\t\t@ctx.translate(x, y)\r\n\t\t@ctx.rotate(@data.dir - Math.PI/2)\r\n\t\t#@ctx.scale(10, 10)\r\n\t\t@ctx.fill(shape)\r\n\t\t@ctx.restore()\r\n\r\n\t\t@ctx.save()\r\n\t\t@ctx.globalAlpha = 0.5\r\n\t\t@ctx.textAlign = 'center'\r\n\t\t@ctx.font = '500 9px \"Nobile\"'\r\n\t\t@ctx.fillText(@info.ship.short, Math.round(x), Math.round(y+18))\r\n\t\t@ctx.restore()\r\n\r\n\tdied: ->\r\n\t\t@div.addClass('dead')\r\n\t\t@div.appendTo(@deadContainer)\r\n\r\n\tupdate: (@data) ->\r\n\t\tif not @data.alive\r\n\t\t\t@alive = false\r\n\t\t\t@died()\r\n\r\n\t\tif @data.visible\r\n\t\t\t@speedDisplay.removeClass('hidden')\r\n\t\telse\r\n\t\t\t@speedDisplay.addClass('hidden')\r\n\r\n\t\t@speedDisplay.text @data.speed.toFixed(0) + ' kts'\r\n\t\tif @targeted\r\n\t\t\t@div.addClass('targeted')\r\n\t\telse\r\n\t\t\t@div.removeClass('targeted')"]},"mtime":1504602601430,"isModule":true}}