{"lib/require.coffee":{"code":"var File, moduleManager;\n\nFunction.prototype.property = function(prop, desc) {\n  return Object.defineProperty(this.prototype, prop, desc);\n};\n\nmoduleManager = {\n  File: File = (function() {\n    function File(manager, absPath) {\n      this.manager = manager;\n      this.absPath = absPath;\n      if (this.manager.files[this.absPath] == null) {\n        throw new Error(\"file does not exist: \" + this.absPath);\n      }\n    }\n\n    File.prototype.read = function() {\n      return this.manager.files[this.absPath];\n    };\n\n    return File;\n\n  })(),\n  modules: {},\n  files: {},\n  module: function(name, closure) {\n    return this.modules[name] = {\n      closure: closure,\n      instance: null\n    };\n  },\n  text: function(name, content) {\n    return this.files[name] = content;\n  },\n  index: function() {\n    this.getLocation();\n    return this[\"import\"]('/index');\n  },\n  getLocation: function() {\n    var script, scripts;\n    if (self.document != null) {\n      scripts = document.getElementsByTagName('script');\n      script = scripts[scripts.length - 1];\n      this.script = script.src;\n    } else {\n      this.script = self.location.href;\n    }\n    return this.location = this.script.slice(0, this.script.lastIndexOf('/') + 1);\n  },\n  abspath: function(fromName, pathName) {\n    var base, baseName, path;\n    if (pathName === '.') {\n      pathName = '';\n    }\n    baseName = fromName.split('/');\n    baseName.pop();\n    baseName = baseName.join('/');\n    if (pathName[0] === '/') {\n      return pathName;\n    } else {\n      path = pathName.split('/');\n      if (baseName === '/') {\n        base = [''];\n      } else {\n        base = baseName.split('/');\n      }\n      while (base.length > 0 && path.length > 0 && path[0] === '..') {\n        base.pop();\n        path.shift();\n      }\n      if (base.length === 0 || path.length === 0 || base[0] !== '') {\n        throw new Error(\"Invalid path: \" + (base.join('/')) + \"/\" + (path.join('/')));\n      }\n      return (base.join('/')) + \"/\" + (path.join('/'));\n    }\n  },\n  \"import\": function(moduleName) {\n    var exports, module, require, sys;\n    if (moduleName != null) {\n      module = this.modules[moduleName];\n      if (module === void 0) {\n        module = this.modules[moduleName + '/index'];\n        if (module != null) {\n          moduleName = moduleName + '/index';\n        } else {\n          throw new Error('Module not found: ' + moduleName);\n        }\n      }\n      if (module.instance === null) {\n        require = (function(_this) {\n          return function(requirePath) {\n            var path;\n            path = _this.abspath(moduleName, requirePath);\n            return _this[\"import\"](path);\n          };\n        })(this);\n        exports = {};\n        sys = {\n          script: this.script,\n          location: this.location,\n          \"import\": (function(_this) {\n            return function(requirePath) {\n              var path;\n              path = _this.abspath(moduleName, requirePath);\n              return _this[\"import\"](path);\n            };\n          })(this),\n          file: (function(_this) {\n            return function(path) {\n              path = _this.abspath(moduleName, path);\n              return new _this.File(_this, path);\n            };\n          })(this),\n          File: File\n        };\n        module.closure(exports, sys);\n        if (exports.index != null) {\n          module.instance = exports.index;\n        } else {\n          module.instance = exports;\n        }\n      }\n      return module.instance;\n    } else {\n      throw new Error('no module name provided');\n    }\n  }\n};\n","map":{"version":3,"file":"","sourceRoot":"","sources":["lib/require.coffee"],"names":[],"mappings":"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","sourcesContent":["Function::property = (prop, desc) ->\n    Object.defineProperty @prototype, prop, desc\n\nmoduleManager =\n    File: class File\n        constructor: (@manager, @absPath) ->\n            if not @manager.files[@absPath]?\n                throw new Error(\"file does not exist: #{@absPath}\")\n        read: -> @manager.files[@absPath]\n\n    modules: {}\n    files: {}\n    module: (name, closure) ->\n        @modules[name] =\n            closure: closure\n            instance: null\n\n    text: (name, content) ->\n        @files[name] = content\n\n    index: ->\n        @getLocation()\n        @import('/index')\n\n    getLocation: ->\n        if self.document?\n            scripts = document.getElementsByTagName 'script'\n            script = scripts[scripts.length-1]\n            @script = script.src\n        else\n            @script = self.location.href\n\n        @location = @script[...@script.lastIndexOf('/')+1]\n\n    abspath: (fromName, pathName) ->\n        if pathName == '.'\n            pathName = ''\n\n        baseName = fromName.split('/')\n        baseName.pop()\n        baseName = baseName.join('/')\n\n        if pathName[0] == '/'\n            return pathName\n        else\n            path = pathName.split '/'\n            if baseName == '/'\n                base = ['']\n            else\n                base = baseName.split '/'\n\n            while base.length > 0 and path.length > 0 and path[0] == '..'\n                base.pop()\n                path.shift()\n\n            if base.length == 0 || path.length == 0 || base[0] != ''\n                throw new Error(\"Invalid path: #{base.join '/'}/#{path.join '/'}\")\n            return \"#{base.join('/')}/#{path.join('/')}\"\n    \n    import: (moduleName) ->\n        if moduleName?\n            module = @modules[moduleName]\n\n            if module == undefined\n                module = @modules[moduleName+'/index']\n                if module?\n                    moduleName = moduleName+'/index'\n                else\n                    throw new Error('Module not found: ' + moduleName)\n            \n            if module.instance == null\n                require = (requirePath) =>\n                    path = @abspath(moduleName, requirePath)\n                    return @import(path)\n\n                exports = {}\n                sys = {\n                    script: @script\n                    location: @location\n                    import: (requirePath) =>\n                        path = @abspath(moduleName, requirePath)\n                        return @import(path)\n                    file: (path) =>\n                        path = @abspath(moduleName, path)\n                        return new @File(@, path)\n                    File: File\n                }\n                module.closure(exports, sys)\n                if exports.index?\n                    module.instance = exports.index\n                else\n                    module.instance = exports\n\n            return module.instance\n        else\n            throw new Error('no module name provided')\n"]},"mtime":1504351840182},"coffee\\index.coffee":{"code":"var Game;\n\nGame = sys[\"import\"]('game');\n\n$(function() {\n  var connection, game;\n  connection = new WebSocket(\"ws://\" + document.location.hostname + \":2503/\");\n  game = new Game();\n  return connection.onmessage = function(arg) {\n    var data;\n    data = arg.data;\n    data = JSON.parse(data);\n    return game.message(data);\n  };\n});\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\index.coffee"],"names":[],"mappings":"AAAA,IAAA;;AAAA,IAAA,GAAO,GAAG,EAAC,MAAD,EAAH,CAAW,MAAX;;AAEP,CAAA,CAAE,SAAA;AACD,MAAA;EAAA,UAAA,GAAa,IAAI,SAAJ,CAAc,OAAA,GAAQ,QAAQ,CAAC,QAAQ,CAAC,QAA1B,GAAmC,QAAjD;EAEb,IAAA,GAAO,IAAI,IAAJ,CAAA;SAEP,UAAU,CAAC,SAAX,GAAuB,SAAC,GAAD;AACtB,QAAA;IADwB,OAAD;IACvB,IAAA,GAAO,IAAI,CAAC,KAAL,CAAW,IAAX;WACP,IAAI,CAAC,OAAL,CAAa,IAAb;EAFsB;AALtB,CAAF","sourcesContent":["Game = sys.import('game')\r\n\r\n$ ->\r\n\tconnection = new WebSocket(\"ws://#{document.location.hostname}:2503/\")\r\n\r\n\tgame = new Game()\r\n\r\n\tconnection.onmessage = ({data}) ->\r\n\t\tdata = JSON.parse(data)\r\n\t\tgame.message(data)"]},"mtime":1504632104529,"isModule":true},"coffee\\game.coffee":{"code":"var Entities, Game, Player,\n  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\nPlayer = sys[\"import\"]('player');\n\nEntities = sys[\"import\"]('entities');\n\nexports.index = Game = (function() {\n  function Game() {\n    this.raf = bind(this.raf, this);\n    var mapdiv;\n    this.sidebar = $('<div class=\"sidebar\"></div>').appendTo('body');\n    $('<h1 class=\"allies\">My Team</h1>').appendTo(this.sidebar);\n    this.alliesAlive = $('<div class=\"players allies\"></div>').appendTo(this.sidebar);\n    this.alliesDead = $('<div class=\"players allies\"></div>').appendTo(this.sidebar);\n    $('<h1 class=\"enemies\">Enemies</h1>').appendTo(this.sidebar);\n    this.enemiesAlive = $('<div class=\"players enemies\"></div>').appendTo(this.sidebar);\n    this.enemiesDead = $('<div class=\"players enemies\"></div>').appendTo(this.sidebar);\n    mapdiv = $('<div class=\"map\"></div>').appendTo('body');\n    this.canvas = $('<canvas></canvas>').appendTo(mapdiv)[0];\n    this.ctx = this.canvas.getContext('2d');\n    this.playersByID = {};\n    this.playersByShipID = {};\n    this.players = [];\n    this.entities = new Entities(this);\n    this.raf();\n  }\n\n  Game.prototype.info = function(data) {\n    var i, len, player, playerData, ref;\n    this.playersByID = {};\n    this.playersByShipID = {};\n    this.players = [];\n    if (data.inMatch) {\n      this.canvas.style.backgroundImage = \"url(pkg/\" + data.map.name + \"/minimap.png)\";\n      this.inMatch = true;\n      this.mapWidth = data.map.border.high[0] - data.map.border.low[0];\n      this.mapHeight = data.map.border.high[2] - data.map.border.low[2];\n      this.mapX = data.map.border.low[0];\n      this.mapY = data.map.border.low[2];\n      ref = data.players;\n      for (i = 0, len = ref.length; i < len; i++) {\n        playerData = ref[i];\n        if (playerData.team === 'ally') {\n          player = new Player(this, playerData, this.alliesAlive, this.alliesDead);\n        } else {\n          player = new Player(this, playerData, this.enemiesAlive, this.enemiesDead);\n        }\n        if (player.self) {\n          this.self = player;\n        }\n        this.players.push(player);\n        this.playersByID[player.id] = player;\n        this.playersByShipID[playerData.ship.id] = player;\n      }\n    } else {\n      this.canvas.style.backgroundImage = 'none';\n      this.inMatch = false;\n      this.self = null;\n      this.alliesDead.empty();\n      this.alliesAlive.empty();\n      this.enemiesDead.empty();\n      this.enemiesAlive.empty();\n    }\n  };\n\n  Game.prototype.message = function(data) {\n    switch (data.type) {\n      case 'info':\n        return this.info(data.data);\n      case 'update':\n        this.camera = data.data.camera;\n        this.ranges = data.data.ranges;\n        return this.updatePlayers(data.data.players);\n      case 'entity':\n        return this.entities.message(data);\n    }\n  };\n\n  Game.prototype.updatePlayers = function(data) {\n    var i, item, len, player;\n    for (i = 0, len = data.length; i < len; i++) {\n      item = data[i];\n      player = this.playersByID[item.id];\n      if (player != null) {\n        player.update(item);\n      }\n    }\n  };\n\n  Game.prototype.drawPlayers = function() {\n    var i, j, len, len1, player, ref, ref1, target, targetId;\n    ref = this.players;\n    for (i = 0, len = ref.length; i < len; i++) {\n      player = ref[i];\n      player.targeted = false;\n    }\n    targetId = this.self.getTargetId();\n    target = this.playersByShipID[targetId];\n    if (target != null) {\n      target.targeted = true;\n      target.drawTargetMarker();\n    }\n    ref1 = this.players;\n    for (j = 0, len1 = ref1.length; j < len1; j++) {\n      player = ref1[j];\n      player.draw();\n    }\n  };\n\n  Game.prototype.drawBorder = function() {\n    var x0, x1, y0, y1;\n    x0 = this.drawAreaX;\n    y0 = this.drawAreaY;\n    x1 = x0 + this.drawAreaSize;\n    y1 = y0 + this.drawAreaSize;\n    this.ctx.strokeStyle = 'rgba(255,255,255,0.25)';\n    this.ctx.beginPath();\n    this.ctx.moveTo(x0, y0);\n    this.ctx.lineTo(x1, y0);\n    this.ctx.lineTo(x1, y1);\n    this.ctx.lineTo(x0, y1);\n    this.ctx.closePath();\n    return this.ctx.stroke();\n  };\n\n  Game.prototype.drawCamera = function() {\n    if (this.self && this.camera) {\n      return this.self.drawCamera(this.camera);\n    }\n  };\n\n  Game.prototype.drawRanges = function() {\n    if (this.self) {\n      return this.self.drawRanges();\n    }\n  };\n\n  Game.prototype.raf = function() {\n    var height, width;\n    width = this.canvas.clientWidth;\n    height = this.canvas.clientHeight;\n    if (width !== this.canvas.width || height !== this.canvas.height) {\n      this.drawAreaSize = Math.min(width, height);\n      this.drawAreaX = (width / 2) - this.drawAreaSize / 2;\n      this.drawAreaY = (height / 2) - this.drawAreaSize / 2;\n      this.canvas.width = width;\n      this.canvas.height = height;\n    }\n    this.width = width;\n    this.height = height;\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    if (this.inMatch) {\n      this.drawBorder();\n      this.drawRanges();\n      this.entities.draw('torpedo');\n      this.entities.draw('smoke');\n      this.drawCamera();\n      this.drawPlayers();\n      this.entities.draw('plane');\n      this.entities.draw('shot');\n    }\n    return requestAnimationFrame(this.raf);\n  };\n\n  Game.prototype.getDrawX = function(x) {\n    x = (x - this.mapX) / this.mapWidth;\n    x = this.drawAreaX + x * this.drawAreaSize;\n    return x;\n  };\n\n  Game.prototype.getDrawY = function(y) {\n    y = 1.0 - (y - this.mapY) / this.mapHeight;\n    y = this.drawAreaY + y * this.drawAreaSize;\n    return y;\n  };\n\n  Game.prototype.toMapDim = function(value) {\n    return value * (this.drawAreaSize / this.mapHeight);\n  };\n\n  return Game;\n\n})();\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\game.coffee"],"names":[],"mappings":"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","sourcesContent":["Player = sys.import 'player'\r\nEntities = sys.import 'entities'\r\n\r\nexports.index = class Game\r\n\tconstructor: ->\r\n\t\t@sidebar = $('<div class=\"sidebar\"></div>').appendTo('body')\r\n\r\n\t\t$('<h1 class=\"allies\">My Team</h1>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@alliesAlive = $('<div class=\"players allies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@alliesDead = $('<div class=\"players allies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\r\n\t\t$('<h1 class=\"enemies\">Enemies</h1>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@enemiesAlive = $('<div class=\"players enemies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\t\t@enemiesDead = $('<div class=\"players enemies\"></div>')\r\n\t\t\t.appendTo(@sidebar)\r\n\r\n\t\tmapdiv = $('<div class=\"map\"></div>').appendTo('body')\r\n\t\t@canvas = $('<canvas></canvas>').appendTo(mapdiv)[0]\r\n\t\t@ctx = @canvas.getContext('2d')\r\n\r\n\t\t@playersByID = {}\r\n\t\t@playersByShipID = {}\r\n\t\t@players = []\r\n\r\n\t\t@entities = new Entities(@)\r\n\r\n\t\t@raf()\r\n\r\n\tinfo: (data) ->\r\n\t\t@playersByID = {}\r\n\t\t@playersByShipID = {}\r\n\t\t@players = []\r\n\t\tif data.inMatch\r\n\t\t\t@canvas.style.backgroundImage = \"url(pkg/#{data.map.name}/minimap.png)\";\r\n\t\t\t@inMatch = true\r\n\t\t\t@mapWidth = data.map.border.high[0] - data.map.border.low[0]\r\n\t\t\t@mapHeight = data.map.border.high[2] - data.map.border.low[2]\r\n\t\t\t@mapX = data.map.border.low[0]\r\n\t\t\t@mapY = data.map.border.low[2]\r\n\r\n\t\t\tfor playerData in data.players\r\n\t\t\t\tif playerData.team == 'ally'\r\n\t\t\t\t\tplayer = new Player(@, playerData, @alliesAlive, @alliesDead)\r\n\t\t\t\telse\r\n\t\t\t\t\tplayer = new Player(@, playerData, @enemiesAlive, @enemiesDead)\r\n\r\n\t\t\t\tif player.self\r\n\t\t\t\t\t@self = player\r\n\r\n\t\t\t\t@players.push(player)\r\n\t\t\t\t@playersByID[player.id] = player\r\n\t\t\t\t@playersByShipID[playerData.ship.id] = player\r\n\t\telse\r\n\t\t\t@canvas.style.backgroundImage = 'none';\r\n\t\t\t@inMatch = false\r\n\t\t\t@self = null\r\n\t\t\t@alliesDead.empty()\r\n\t\t\t@alliesAlive.empty()\r\n\t\t\t@enemiesDead.empty()\r\n\t\t\t@enemiesAlive.empty()\r\n\t\treturn\r\n\r\n\tmessage: (data) ->\r\n\t\tswitch data.type\r\n\t\t\twhen 'info'\r\n\t\t\t\t@info(data.data)\r\n\t\t\twhen 'update'\r\n\t\t\t\t@camera = data.data.camera\r\n\t\t\t\t@ranges = data.data.ranges\r\n\t\t\t\t@updatePlayers(data.data.players)\r\n\t\t\twhen 'entity'\r\n\t\t\t\t@entities.message(data)\r\n\r\n\tupdatePlayers: (data) ->\r\n\t\tfor item in data\r\n\t\t\tplayer = @playersByID[item.id]\r\n\t\t\tif player?\r\n\t\t\t\tplayer.update(item)\r\n\t\treturn\r\n\r\n\tdrawPlayers: ->\r\n\t\tfor player in @players\r\n\t\t\tplayer.targeted = false\r\n\r\n\t\ttargetId = @self.getTargetId()\r\n\t\ttarget = @playersByShipID[targetId]\r\n\t\tif target?\r\n\t\t\ttarget.targeted = true\r\n\t\t\ttarget.drawTargetMarker()\r\n\r\n\t\tfor player in @players\r\n\t\t\tplayer.draw()\r\n\t\treturn\r\n\r\n\tdrawBorder: ->\r\n\t\tx0 = @drawAreaX\r\n\t\ty0 = @drawAreaY\r\n\t\tx1 = x0 + @drawAreaSize\r\n\t\ty1 = y0 + @drawAreaSize\r\n\r\n\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.25)'\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.moveTo(x0, y0)\r\n\t\t@ctx.lineTo(x1, y0)\r\n\t\t@ctx.lineTo(x1, y1)\r\n\t\t@ctx.lineTo(x0, y1)\r\n\t\t@ctx.closePath()\r\n\t\t@ctx.stroke()\r\n\r\n\tdrawCamera: ->\r\n\t\tif @self and @camera\r\n\t\t\t@self.drawCamera(@camera)\r\n\r\n\tdrawRanges: ->\r\n\t\tif @self then @self.drawRanges()\r\n\r\n\traf: =>\r\n\t\twidth = @canvas.clientWidth\r\n\t\theight = @canvas.clientHeight\r\n\r\n\t\tif width != @canvas.width or height != @canvas.height\r\n\t\t\t@drawAreaSize = Math.min(width, height)\r\n\t\t\t@drawAreaX = (width/2) - @drawAreaSize/2\r\n\t\t\t@drawAreaY = (height/2) - @drawAreaSize/2\r\n\r\n\t\t\t@canvas.width = width\r\n\t\t\t@canvas.height = height\r\n\r\n\t\t@width = width\r\n\t\t@height = height\r\n\r\n\t\t@ctx.clearRect(0, 0, @canvas.width, @canvas.height)\r\n\r\n\t\tif @inMatch\r\n\t\t\t@drawBorder()\r\n\t\t\t@drawRanges()\r\n\t\t\t@entities.draw('torpedo')\r\n\t\t\t@entities.draw('smoke')\r\n\t\t\t@drawCamera()\r\n\t\t\t@drawPlayers()\r\n\t\t\t@entities.draw('plane')\r\n\t\t\t@entities.draw('shot')\r\n\r\n\t\trequestAnimationFrame(@raf)\r\n\r\n\tgetDrawX: (x) ->\r\n\t\tx = (x-@mapX)/@mapWidth\r\n\t\tx = @drawAreaX + x*@drawAreaSize\r\n\t\treturn x\r\n\r\n\tgetDrawY: (y) ->\r\n\t\ty = 1.0 - (y-@mapY)/@mapHeight\r\n\t\ty = @drawAreaY + y*@drawAreaSize\r\n\t\treturn y\r\n\r\n\ttoMapDim: (value) ->\r\n\t\treturn value * (@drawAreaSize/@mapHeight)"]},"mtime":1504876295286,"isModule":true},"coffee\\player.coffee":{"code":"var Player, shapes;\n\nshapes = {\n  Cruiser: new Path2D('m -8,-4 v 8 h 3.8164062 l 3.72656255,-8 z m 9.7480469,0 -3.7265625,8 H 5 L 9,0 5,-4 Z'),\n  Battleship: new Path2D('m -8,-4 v 8 h 1.300781 l 3.726563,-8 z m 7.232422,0 -3.726563,8 h 2.373047 L 1.605469,-4 Z M 3.8125,-4 0.085938,4 H 5 L 9,0 5,-4 Z'),\n  Destroyer: new Path2D('M -5,-4 6,0 -5,4 v -8'),\n  AirCarrier: new Path2D('m -8,-4 v 3 H 1 V -4 Z M 3,-4 V 4 H 5 L 9,0 5,-4 Z M -8,1 V 4 H 1 V 1 Z'),\n  ship: new Path2D('M 9,0 5,4 H -8 V -4 H 5 Z'),\n  self: new Path2D('M -5,-4 6,0 -5,4 -3,0 -5,-4')\n};\n\nexports.index = Player = (function() {\n  function Player(game, info, aliveContainer, deadContainer) {\n    this.game = game;\n    this.info = info;\n    this.aliveContainer = aliveContainer;\n    this.deadContainer = deadContainer;\n    this.ctx = this.game.ctx;\n    this.id = this.info.id;\n    this.self = this.info.self;\n    this.alive = true;\n    this.div = $('<div class=\"player\"></div>').appendTo(this.aliveContainer);\n    $('<div class=\"name\"></div>').appendTo(this.div).text(this.info.name);\n    $('<div class=\"ship\"></div>').appendTo(this.div).text(this.info.ship.name);\n    this.speedDisplay = $('<div class=\"speed\"></div>').appendTo(this.div);\n  }\n\n  Player.prototype.getTargetId = function() {\n    if (this.data != null) {\n      return this.data.targeting;\n    }\n  };\n\n  Player.prototype.draw = function() {\n    var c, s, x, y;\n    if (this.data == null) {\n      return;\n    }\n    if (this.data.spotted == null) {\n      return;\n    }\n    x = this.game.getDrawX(this.data.position[0]);\n    y = this.game.getDrawY(this.data.position[2]);\n    s = Math.sin(this.data.dir);\n    c = Math.cos(this.data.dir);\n    if (this.self) {\n      return this.drawSelf(x, y, s, c);\n    } else {\n      return this.drawShip(x, y, s, c);\n    }\n  };\n\n  Player.prototype.drawTargetMarker = function() {\n    var c, q, s, spacing, span, x, y;\n    if (this.data != null) {\n      x = this.game.getDrawX(this.data.position[0]);\n      y = this.game.getDrawY(this.data.position[2]);\n      s = Math.sin(this.data.dir);\n      c = Math.cos(this.data.dir);\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, y);\n      this.ctx.lineTo(x + s * 2000, y - c * 2000);\n      this.ctx.stroke();\n      spacing = Math.PI / 10;\n      span = Math.PI / 4 - spacing;\n      q = Math.PI / 2;\n      this.ctx.save();\n      this.ctx.translate(x, y);\n      this.ctx.rotate(this.data.dir);\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.8)';\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, -span, span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, q - span, q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, 2 * q - span, 2 * q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.arc(0, 0, 25, 3 * q - span, 3 * q + span);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(14, +14);\n      this.ctx.lineTo(21, +21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(-14, -14);\n      this.ctx.lineTo(-21, -21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(+14, -14);\n      this.ctx.lineTo(+21, -21);\n      this.ctx.stroke();\n      this.ctx.beginPath();\n      this.ctx.moveTo(-14, +14);\n      this.ctx.lineTo(-21, +21);\n      this.ctx.stroke();\n      return this.ctx.restore();\n    }\n  };\n\n  Player.prototype.drawSelf = function(x, y, s, c) {\n    var color, shape;\n    if (this.data.alive) {\n      color = 'white';\n    } else {\n      color = 'black';\n    }\n    this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n    this.ctx.beginPath();\n    this.ctx.moveTo(x, y);\n    this.ctx.lineTo(x + s * 2000, y - c * 2000);\n    this.ctx.stroke();\n    this.ctx.fillStyle = color;\n    shape = shapes.self;\n    this.ctx.save();\n    this.ctx.shadowColor = 'rgba(0, 0, 0, 1)';\n    this.ctx.shadowBlur = 10;\n    this.ctx.translate(x, y);\n    this.ctx.rotate(this.data.dir - Math.PI / 2);\n    this.ctx.scale(1.2, 1.2);\n    this.ctx.fill(shape);\n    return this.ctx.restore();\n  };\n\n  Player.prototype.drawShipShape = function(x, y, s, c) {\n    var shape;\n    if (this.data.alive) {\n      if (this.info.team === 'ally') {\n        this.ctx.fillStyle = '#45e9af';\n      } else {\n        if (this.data.spotted) {\n          this.ctx.fillStyle = '#ff3615';\n        } else {\n          this.ctx.fillStyle = '#ccc';\n        }\n      }\n    } else {\n      this.ctx.fillStyle = 'rgba(0,0,0,0.5)';\n    }\n    shape = shapes[this.info.ship.type];\n    this.ctx.save();\n    this.ctx.shadowColor = 'rgba(0, 0, 0, 1)';\n    this.ctx.shadowBlur = 10;\n    this.ctx.translate(x, y);\n    this.ctx.rotate(this.data.dir - Math.PI / 2);\n    this.ctx.scale(0.8, 0.8);\n    this.ctx.fill(shape);\n    return this.ctx.restore();\n  };\n\n  Player.prototype.drawShipExtra = function(x, y, s, c) {\n    if (this.data.alive) {\n      if (this.info.team === 'ally') {\n        this.ctx.fillStyle = '#45e9af';\n      } else {\n        this.ctx.fillStyle = '#ff3615';\n      }\n      this.ctx.save();\n      this.ctx.globalAlpha = 0.8;\n      this.ctx.textAlign = 'center';\n      this.ctx.font = '500 9px \"Nobile\"';\n      this.ctx.fillText(this.info.ship.short, Math.round(x), Math.round(y + 18));\n      this.ctx.restore();\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.2)';\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, y);\n      this.ctx.lineTo(x + s * 30, y - c * 30);\n      return this.ctx.stroke();\n    }\n  };\n\n  Player.prototype.drawShip = function(x, y, s, c) {\n    this.drawShipShape(x, y, s, c);\n    return this.drawShipExtra(x, y, s, c);\n  };\n\n  Player.prototype.drawCamera = function(camera) {\n    var dist, dx, dy, dz, ref, x, y;\n    if (this.data && this.game.ranges) {\n      x = this.game.getDrawX(this.data.position[0]);\n      y = this.game.getDrawY(this.data.position[2]);\n      dist = this.game.toMapDim(this.game.ranges.vision);\n      ref = camera.dir, dx = ref[0], dy = ref[1], dz = ref[2];\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.5)';\n      this.ctx.beginPath();\n      this.ctx.moveTo(x, y);\n      this.ctx.lineTo(x + dx * dist, y - dz * dist);\n      return this.ctx.stroke();\n    }\n  };\n\n  Player.prototype.drawRanges = function() {\n    var ranges, x, y;\n    if (this.data && this.game.ranges) {\n      x = this.game.getDrawX(this.data.position[0]);\n      y = this.game.getDrawY(this.data.position[2]);\n      ranges = this.game.ranges;\n      this.drawCircle(x, y, ranges.seaVisible, 'rgba(50,128,20,0.1)', false);\n      this.drawCircle(x, y, ranges.seaVisible, 'rgba(50,128,20,0.5)', true);\n      this.drawCircle(x, y, ranges.airVisible, 'rgba(50,128,20,0.5)', true, [5, 5]);\n      this.drawCircle(x, y, ranges.gun, 'rgba(255,255,255,0.9)');\n      return this.drawCircle(x, y, ranges.torpedo, 'rgba(255,255,255,0.5)');\n    }\n  };\n\n  Player.prototype.drawCircle = function(x, y, radius, color, stroke, dash) {\n    if (stroke == null) {\n      stroke = true;\n    }\n    if (dash == null) {\n      dash = null;\n    }\n    radius = this.game.toMapDim(radius);\n    this.ctx.save();\n    if (dash) {\n      this.ctx.setLineDash(dash);\n    }\n    this.ctx.beginPath();\n    this.ctx.arc(x, y, radius, 0, Math.PI * 2);\n    if (stroke) {\n      this.ctx.strokeStyle = color;\n      this.ctx.stroke();\n    } else {\n      this.ctx.fillStyle = color;\n      this.ctx.fill();\n    }\n    return this.ctx.restore();\n  };\n\n  Player.prototype.died = function() {\n    this.div.addClass('dead');\n    return this.div.appendTo(this.deadContainer);\n  };\n\n  Player.prototype.update = function(data) {\n    this.data = data;\n    if (!this.data.alive) {\n      this.alive = false;\n      this.died();\n    }\n    if (this.data.visible) {\n      this.speedDisplay.removeClass('hidden');\n    } else {\n      this.speedDisplay.addClass('hidden');\n    }\n    this.speedDisplay.text(this.data.speed.toFixed(0) + ' kts');\n    if (this.targeted) {\n      return this.div.addClass('targeted');\n    } else {\n      return this.div.removeClass('targeted');\n    }\n  };\n\n  return Player;\n\n})();\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\player.coffee"],"names":[],"mappings":"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","sourcesContent":["shapes =\r\n\tCruiser: new Path2D('m -8,-4 v 8 h 3.8164062 l 3.72656255,-8 z m 9.7480469,0 -3.7265625,8 H 5 L 9,0 5,-4 Z')\r\n\tBattleship: new Path2D('m -8,-4 v 8 h 1.300781 l 3.726563,-8 z m 7.232422,0 -3.726563,8 h 2.373047 L 1.605469,-4 Z M 3.8125,-4 0.085938,4 H 5 L 9,0 5,-4 Z')\r\n\tDestroyer: new Path2D('M -5,-4 6,0 -5,4 v -8')\r\n\tAirCarrier: new Path2D('m -8,-4 v 3 H 1 V -4 Z M 3,-4 V 4 H 5 L 9,0 5,-4 Z M -8,1 V 4 H 1 V 1 Z')\r\n\tship: new Path2D('M 9,0 5,4 H -8 V -4 H 5 Z')\r\n\tself: new Path2D('M -5,-4 6,0 -5,4 -3,0 -5,-4')\r\n\r\nexports.index = class Player\r\n\tconstructor: (@game, @info, @aliveContainer, @deadContainer) ->\r\n\t\t@ctx = @game.ctx\r\n\t\t@id = @info.id\r\n\t\t@self = @info.self\r\n\t\t@alive = true\r\n\r\n\t\t@div = $('<div class=\"player\"></div>')\r\n\t\t\t.appendTo(@aliveContainer)\r\n\r\n\t\t$('<div class=\"name\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\t\t\t.text(@info.name)\r\n\r\n\t\t$('<div class=\"ship\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\t\t\t.text(@info.ship.name)\r\n\r\n\t\t@speedDisplay = $('<div class=\"speed\"></div>')\r\n\t\t\t.appendTo(@div)\r\n\r\n\tgetTargetId: ->\r\n\t\tif @data?\r\n\t\t\treturn @data.targeting\r\n\r\n\tdraw: ->\r\n\t\tif not @data?\r\n\t\t\treturn\r\n\r\n\t\tif not @data.spotted?\r\n\t\t\treturn\r\n\r\n\t\tx = @game.getDrawX(@data.position[0])\r\n\t\ty = @game.getDrawY(@data.position[2])\r\n\t\ts = Math.sin(@data.dir)\r\n\t\tc = Math.cos(@data.dir)\r\n\r\n\t\tif @self\r\n\t\t\t@drawSelf(x, y, s, c)\r\n\t\telse\r\n\t\t\t@drawShip(x, y, s, c)\r\n\r\n\tdrawTargetMarker: ->\r\n\t\tif @data?\r\n\t\t\tx = @game.getDrawX(@data.position[0])\r\n\t\t\ty = @game.getDrawY(@data.position[2])\r\n\t\t\ts = Math.sin(@data.dir)\r\n\t\t\tc = Math.cos(@data.dir)\r\n\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x, y)\r\n\t\t\t@ctx.lineTo(x+s*2000, y-c*2000)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\tspacing = Math.PI/10\r\n\t\t\tspan = Math.PI/4 - spacing\r\n\t\t\tq = Math.PI/2\r\n\r\n\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.translate(x, y)\r\n\t\t\t@ctx.rotate(@data.dir)\r\n\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.8)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, -span, span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, q-span, q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, 2*q-span, 2*q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(0, 0, 25, 3*q-span, 3*q+span)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(14, +14)\r\n\t\t\t@ctx.lineTo(21, +21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(-14, -14)\r\n\t\t\t@ctx.lineTo(-21, -21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(+14, -14)\r\n\t\t\t@ctx.lineTo(+21, -21)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(-14, +14)\r\n\t\t\t@ctx.lineTo(-21, +21)\r\n\t\t\t@ctx.stroke()\r\n\t\t\t@ctx.restore()\r\n\r\n\tdrawSelf: (x, y, s, c) ->\r\n\t\tif @data.alive\r\n\t\t\tcolor = 'white'\r\n\t\telse\r\n\t\t\tcolor = 'black'\r\n\r\n\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.moveTo(x, y)\r\n\t\t@ctx.lineTo(x+s*2000, y-c*2000)\r\n\t\t@ctx.stroke()\r\n\r\n\t\t@ctx.fillStyle = color\r\n\t\tshape = shapes.self\r\n\t\t@ctx.save()\r\n\t\t@ctx.shadowColor = 'rgba(0, 0, 0, 1)'\r\n\t\t@ctx.shadowBlur = 10\r\n\t\t@ctx.translate(x, y)\r\n\t\t@ctx.rotate(@data.dir - Math.PI/2)\r\n\t\t@ctx.scale(1.2, 1.2)\r\n\t\t@ctx.fill(shape)\r\n\t\t@ctx.restore()\r\n\r\n\tdrawShipShape: (x, y, s, c) ->\r\n\t\tif @data.alive\r\n\t\t\tif @info.team == 'ally'\r\n\t\t\t\t@ctx.fillStyle = '#45e9af'\r\n\t\t\telse\r\n\t\t\t\tif @data.spotted\r\n\t\t\t\t\t@ctx.fillStyle = '#ff3615'\r\n\t\t\t\telse\r\n\t\t\t\t\t@ctx.fillStyle = '#ccc'\r\n\t\telse\r\n\t\t\t@ctx.fillStyle = 'rgba(0,0,0,0.5)'\r\n\r\n\t\tshape = shapes[@info.ship.type]\r\n\t\t@ctx.save()\r\n\t\t@ctx.shadowColor = 'rgba(0, 0, 0, 1)'\r\n\t\t@ctx.shadowBlur = 10\r\n\t\t@ctx.translate(x, y)\r\n\t\t@ctx.rotate(@data.dir - Math.PI/2)\r\n\t\t@ctx.scale(0.8, 0.8)\r\n\t\t@ctx.fill(shape)\r\n\t\t@ctx.restore()\r\n\r\n\tdrawShipExtra: (x, y, s, c) ->\r\n\t\tif @data.alive\r\n\t\t\tif @info.team == 'ally'\r\n\t\t\t\t@ctx.fillStyle = '#45e9af'\r\n\t\t\telse\r\n\t\t\t\t@ctx.fillStyle = '#ff3615'\r\n\t\t\t\t\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.globalAlpha = 0.8\r\n\t\t\t@ctx.textAlign = 'center'\r\n\t\t\t@ctx.font = '500 9px \"Nobile\"'\r\n\t\t\t@ctx.fillText(@info.ship.short, Math.round(x), Math.round(y+18))\r\n\t\t\t@ctx.restore()\r\n\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.2)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x, y)\r\n\t\t\t@ctx.lineTo(x+s*30, y-c*30)\r\n\t\t\t@ctx.stroke()\r\n\r\n\tdrawShip: (x, y, s, c) ->\r\n\t\t@drawShipShape(x, y, s, c)\r\n\t\t@drawShipExtra(x, y, s, c)\r\n\r\n\tdrawCamera: (camera) ->\r\n\t\tif @data and @game.ranges\r\n\t\t\tx = @game.getDrawX(@data.position[0])\r\n\t\t\ty = @game.getDrawY(@data.position[2])\r\n\t\t\tdist = @game.toMapDim(@game.ranges.vision)\r\n\r\n\t\t\t[dx,dy,dz] = camera.dir\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.5)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x,y)\r\n\t\t\t@ctx.lineTo(x+dx*dist, y-dz*dist)\r\n\t\t\t@ctx.stroke()\r\n\r\n\tdrawRanges: ->\r\n\t\tif @data and @game.ranges\r\n\t\t\tx = @game.getDrawX(@data.position[0])\r\n\t\t\ty = @game.getDrawY(@data.position[2])\r\n\t\t\tranges = @game.ranges\r\n\r\n\t\t\t@drawCircle(x, y, ranges.seaVisible, 'rgba(50,128,20,0.1)', false)\r\n\t\t\t@drawCircle(x, y, ranges.seaVisible, 'rgba(50,128,20,0.5)', true)\r\n\t\t\t@drawCircle(x, y, ranges.airVisible, 'rgba(50,128,20,0.5)', true, [5, 5])\r\n\t\t\t@drawCircle(x, y, ranges.gun, 'rgba(255,255,255,0.9)')\r\n\t\t\t@drawCircle(x, y, ranges.torpedo, 'rgba(255,255,255,0.5)')\r\n\r\n\tdrawCircle: (x, y, radius, color, stroke=true, dash=null) ->\r\n\t\tradius = @game.toMapDim(radius)\r\n\t\t@ctx.save()\r\n\t\tif dash\r\n\t\t\t@ctx.setLineDash(dash)\r\n\t\t@ctx.beginPath()\r\n\t\t@ctx.arc(x, y, radius, 0, Math.PI*2)\r\n\t\tif stroke\r\n\t\t\t@ctx.strokeStyle = color\r\n\t\t\t@ctx.stroke()\r\n\t\telse\r\n\t\t\t@ctx.fillStyle = color\r\n\t\t\t@ctx.fill()\r\n\t\t@ctx.restore()\r\n\r\n\tdied: ->\r\n\t\t@div.addClass('dead')\r\n\t\t@div.appendTo(@deadContainer)\r\n\r\n\tupdate: (@data) ->\r\n\t\tif not @data.alive\r\n\t\t\t@alive = false\r\n\t\t\t@died()\r\n\r\n\t\tif @data.visible\r\n\t\t\t@speedDisplay.removeClass('hidden')\r\n\t\telse\r\n\t\t\t@speedDisplay.addClass('hidden')\r\n\r\n\t\t@speedDisplay.text @data.speed.toFixed(0) + ' kts'\r\n\t\tif @targeted\r\n\t\t\t@div.addClass('targeted')\r\n\t\telse\r\n\t\t\t@div.removeClass('targeted')"]},"mtime":1504877229089,"isModule":true},"coffee\\entities.coffee":{"code":"var Entities, Plane, Shot, SmokeScreen, Torpedo, entityTypes, shapes;\n\nshapes = {\n  torpedo: new Path2D('M -3 -0.75 L -3 0.75 L -2 0.75 L -2 -0.75 L -3 -0.75 z M -1.25 -0.75 L -1.25 0.75 L 3.25 0.75 L 3.25 -0.75 L -1.25 -0.75 z'),\n  bomb: new Path2D('m 0.75000003,-2.0000008 h -1.5 v 1 h 1.5 z m 0,1.74999999 h -1.5 l 6e-8,2.00000011 h 1.5 z'),\n  plane: new Path2D('m -3.7500001,-0.25000057 0.25,-1.25000003 h 0.5 L -2.75,-0.50000057 -0.75000013,-0.74998057 6.9999999e-8,-3.4999806 H 0.7499997 l 0.25,2.75000003 0.75,0.25 v 0.9999998 l -0.75,0.25 -0.25,2.74998017 H 9.7e-7 L -0.75000003,0.74999923 -2.75,0.49999923 -3.0000001,1.4999993 h -0.5 l -0.25,-1.25000007 z'),\n  eye: new Path2D('M 0,-1.5 -1.9192628,-0.75 -3,0 -1.9192628,0.75 0,1.5 1.9192628,0.75 3,0 1.9192628,-0.75 Z M 0,-1 0.70710678,-0.70710678 1,0 0.70710678,0.70710678 0,1 -0.70710678,0.70710678 -1,0 -0.70710678,-0.70710678 Z M 0,-0.5 -0.35355339,-0.35355339 -0.5,0 -0.35355339,0.35355339 0,0.5 0.35355339,0.35355339 0.5,0 0.35355339,-0.35355339 Z'),\n  shots: new Path2D('M -2 -1.5 L -2 -1 L -1 -1 L -1 -1.5 L -2 -1.5 z M -0.5 -1.5 L -0.5 -1 L 0.5 -1 L 0.5 -1.5 L -0.5 -1.5 z M 1 -1.5 L 1 -1 L 2 -1 L 2 -1.5 L 1 -1.5 z M -1 -0.25 L -1 0.25 L 0 0.25 L 0 -0.25 L -1 -0.25 z M 0.5 -0.25 L 0.5 0.25 L 1.5 0.25 L 1.5 -0.25 L 0.5 -0.25 z M 2 -0.25 L 2 0.25 L 3 0.25 L 3 -0.25 L 2 -0.25 z M -2 1 L -2 1.5 L -1 1.5 L -1 1 L -2 1 z M -0.5 1 L -0.5 1.5 L 0.5 1.5 L 0.5 1 L -0.5 1 z M 1 1 L 1 1.5 L 2 1.5 L 2 1 L 1 1 z ')\n};\n\nentityTypes = {\n  smoke: SmokeScreen = (function() {\n    SmokeScreen.prototype.name = 'smoke';\n\n    function SmokeScreen(game, data) {\n      this.game = game;\n      this.ctx = this.game.ctx;\n      this.radius = data.data.radius;\n      this.color = 'rgba(255,255,255,0.1)';\n    }\n\n    SmokeScreen.prototype.draw = function() {\n      var i, len, ref, ref1, x, y;\n      if (this.points != null) {\n        this.ctx.save();\n        this.ctx.fillStyle = this.color;\n        ref = this.points;\n        for (i = 0, len = ref.length; i < len; i++) {\n          ref1 = ref[i], x = ref1[0], y = ref1[1];\n          x = this.game.getDrawX(x);\n          y = this.game.getDrawY(y);\n          this.ctx.beginPath();\n          this.ctx.arc(x, y, this.radius, 0, Math.PI * 2);\n          this.ctx.fill();\n        }\n        return this.ctx.restore();\n      }\n    };\n\n    SmokeScreen.prototype.update = function(data) {\n      return this.points = data.data;\n    };\n\n    return SmokeScreen;\n\n  })(),\n  shot: Shot = (function() {\n    Shot.prototype.name = 'shot';\n\n    function Shot(game, data) {\n      this.game = game;\n      this.ctx = this.game.ctx;\n      this.data = data.data;\n      this.startTime = performance.now() / 1000;\n    }\n\n    Shot.prototype.draw = function() {\n      var dist, f, l, now, x, x0, x1, xd, y, y0, y1, yd;\n      x0 = this.game.getDrawX(this.data.origin[0]);\n      y0 = this.game.getDrawY(this.data.origin[2]);\n      x1 = this.game.getDrawX(this.data.target[0]);\n      y1 = this.game.getDrawY(this.data.target[2]);\n      xd = this.data.dir[0];\n      yd = -this.data.dir[2];\n      l = Math.sqrt(xd * xd + yd * yd);\n      xd /= l;\n      yd /= l;\n      dist = this.game.toMapDim(this.data.distance);\n\n      /*\n      \t\t\t@ctx.save()\n      \t\t\t@ctx.strokeStyle = 'red'\n      \t\t\t#@ctx.strokeStyle = 'rgba(255,255,255,0.1)'\n      \t\t\t@ctx.beginPath()\n      \t\t\t@ctx.moveTo(x0, y0+2)\n      \t\t\t@ctx.lineTo(x1, y1+2)\n      \t\t\t@ctx.stroke()\n      \t\t\t@ctx.restore()\n       */\n      this.ctx.save();\n      this.ctx.strokeStyle = 'rgba(255,255,255,0.1)';\n      this.ctx.beginPath();\n      this.ctx.moveTo(x0, y0);\n      this.ctx.lineTo(x0 + xd * dist, y0 + yd * dist);\n      this.ctx.stroke();\n      this.ctx.restore();\n      now = performance.now() / 1000;\n      f = (now - this.startTime) / (this.data.time + 0.4);\n      x = x0 * (1 - f) + x1 * f;\n      y = y0 * (1 - f) + y1 * f;\n      if (this.data.type === 'AP') {\n        this.ctx.fillStyle = '#57aeff';\n      } else {\n        this.ctx.fillStyle = 'red';\n      }\n      this.ctx.beginPath();\n      this.ctx.arc(x, y, 1, 0, Math.PI * 2);\n      this.ctx.fill();\n      return this.ctx.fill();\n    };\n\n    Shot.prototype.update = function() {\n      return null;\n    };\n\n    return Shot;\n\n  })(),\n  torpedo: Torpedo = (function() {\n    Torpedo.prototype.name = 'torpedo';\n\n    function Torpedo(game, data) {\n      var l, xd, yd;\n      this.game = game;\n      this.ctx = this.game.ctx;\n      this.data = data.data;\n      this.startPosition = this.position = this.data.position;\n      this.direction = this.data.direction;\n      this.speed = this.data.speed;\n      this.startTime = performance.now() / 1000;\n      xd = this.direction[0];\n      yd = this.direction[2];\n      l = Math.sqrt(xd * xd + yd * yd);\n      this.xd = xd / l;\n      this.yd = yd / l;\n      this.dir = Math.atan2(this.xd, this.yd);\n      this.grad = this.ctx.createLinearGradient(0, 0, 200, 0);\n      this.grad.addColorStop(0, \"rgba(255,0,0,0.8)\");\n      this.grad.addColorStop(1, \"rgba(255,0,0,0\");\n    }\n\n    Torpedo.prototype.draw = function() {\n      var delta, x0, x2, y0, y2;\n      delta = performance.now() / 1000 - this.startTime;\n      x0 = this.startPosition[0];\n      y0 = this.startPosition[2];\n      x2 = this.game.getDrawX(x0 + this.xd * this.speed * delta);\n      y2 = this.game.getDrawY(y0 + this.yd * this.speed * delta);\n      this.ctx.save();\n      this.ctx.translate(x2, y2);\n      this.ctx.rotate(this.dir - Math.PI / 2);\n      this.ctx.save();\n      this.ctx.scale(1.5, 1.5);\n      this.ctx.fillStyle = 'red';\n      this.ctx.fill(shapes.torpedo);\n      this.ctx.restore();\n      this.ctx.strokeStyle = this.grad;\n      this.ctx.beginPath();\n      this.ctx.moveTo(0, 0);\n      this.ctx.lineTo(200, 0);\n      this.ctx.stroke();\n      return this.ctx.restore();\n    };\n\n    Torpedo.prototype.update = function(arg) {\n      var data;\n      data = arg.data;\n      return this.position = data;\n    };\n\n    return Torpedo;\n\n  })(),\n  plane: Plane = (function() {\n    Plane.prototype.shapes = [shapes.eye, shapes.bomb, shapes.torpedo, shapes.shots];\n\n    Plane.prototype.name = 'plane';\n\n    function Plane(game, arg) {\n      var data;\n      this.game = game;\n      data = arg.data;\n      this.ctx = this.game.ctx;\n      this.info = data;\n    }\n\n    Plane.prototype.draw = function() {\n      var x, y;\n      if (this.position != null) {\n        x = this.game.getDrawX(this.position[0]);\n        y = this.game.getDrawY(this.position[2]);\n        this.ctx.save();\n        if (this.info.team === 'ally') {\n          this.ctx.fillStyle = '#45e9af';\n        } else {\n          this.ctx.fillStyle = '#ff3615';\n        }\n        this.ctx.translate(x, y);\n        this.ctx.save();\n        this.ctx.shadowColor = 'rgba(0, 0, 0, 1)';\n        this.ctx.shadowBlur = 10;\n        this.ctx.translate(0, 13);\n        this.ctx.scale(2, 2);\n        this.ctx.fill(this.shapes[this.info.type]);\n        this.ctx.restore();\n        this.ctx.scale(1.7, 1.7);\n        this.ctx.rotate(this.dir - Math.PI / 2);\n        this.ctx.fill(shapes.plane);\n        return this.ctx.restore();\n      }\n    };\n\n    Plane.prototype.update = function(arg) {\n      var data, l, xd, yd;\n      data = arg.data;\n      this.position = data.position;\n      this.direction = data.direction;\n      this.count = data.count;\n      xd = this.direction[0];\n      yd = this.direction[2];\n      l = Math.sqrt(xd * xd + yd * yd);\n      this.xd = xd / l;\n      this.yd = yd / l;\n      return this.dir = Math.atan2(this.xd, this.yd);\n    };\n\n    return Plane;\n\n  })()\n};\n\nexports.index = Entities = (function() {\n  function Entities(game) {\n    this.game = game;\n    this.entities = {};\n  }\n\n  Entities.prototype.message = function(data) {\n    switch (data.action) {\n      case 'create':\n        return this.entities[data.id] = new entityTypes[data.entityType](this.game, data);\n      case 'update':\n        return this.entities[data.id].update(data);\n      case 'remove':\n        return delete this.entities[data.id];\n    }\n  };\n\n  Entities.prototype.draw = function(type) {\n    var entity, id, ref, results;\n    ref = this.entities;\n    results = [];\n    for (id in ref) {\n      entity = ref[id];\n      if (entity.name === type) {\n        results.push(entity.draw());\n      } else {\n        results.push(void 0);\n      }\n    }\n    return results;\n  };\n\n  return Entities;\n\n})();\n","map":{"version":3,"file":"","sourceRoot":"","sources":["coffee\\entities.coffee"],"names":[],"mappings":"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","sourcesContent":["shapes =\r\n\ttorpedo: new Path2D('M -3 -0.75 L -3 0.75 L -2 0.75 L -2 -0.75 L -3 -0.75 z M -1.25 -0.75 L -1.25 0.75 L 3.25 0.75 L 3.25 -0.75 L -1.25 -0.75 z')\r\n\tbomb: new Path2D('m 0.75000003,-2.0000008 h -1.5 v 1 h 1.5 z m 0,1.74999999 h -1.5 l 6e-8,2.00000011 h 1.5 z')\r\n\tplane: new Path2D('m -3.7500001,-0.25000057 0.25,-1.25000003 h 0.5 L -2.75,-0.50000057 -0.75000013,-0.74998057 6.9999999e-8,-3.4999806 H 0.7499997 l 0.25,2.75000003 0.75,0.25 v 0.9999998 l -0.75,0.25 -0.25,2.74998017 H 9.7e-7 L -0.75000003,0.74999923 -2.75,0.49999923 -3.0000001,1.4999993 h -0.5 l -0.25,-1.25000007 z')\t\r\n\teye: new Path2D('M 0,-1.5 -1.9192628,-0.75 -3,0 -1.9192628,0.75 0,1.5 1.9192628,0.75 3,0 1.9192628,-0.75 Z M 0,-1 0.70710678,-0.70710678 1,0 0.70710678,0.70710678 0,1 -0.70710678,0.70710678 -1,0 -0.70710678,-0.70710678 Z M 0,-0.5 -0.35355339,-0.35355339 -0.5,0 -0.35355339,0.35355339 0,0.5 0.35355339,0.35355339 0.5,0 0.35355339,-0.35355339 Z')\r\n\tshots: new Path2D('M -2 -1.5 L -2 -1 L -1 -1 L -1 -1.5 L -2 -1.5 z M -0.5 -1.5 L -0.5 -1 L 0.5 -1 L 0.5 -1.5 L -0.5 -1.5 z M 1 -1.5 L 1 -1 L 2 -1 L 2 -1.5 L 1 -1.5 z M -1 -0.25 L -1 0.25 L 0 0.25 L 0 -0.25 L -1 -0.25 z M 0.5 -0.25 L 0.5 0.25 L 1.5 0.25 L 1.5 -0.25 L 0.5 -0.25 z M 2 -0.25 L 2 0.25 L 3 0.25 L 3 -0.25 L 2 -0.25 z M -2 1 L -2 1.5 L -1 1.5 L -1 1 L -2 1 z M -0.5 1 L -0.5 1.5 L 0.5 1.5 L 0.5 1 L -0.5 1 z M 1 1 L 1 1.5 L 2 1.5 L 2 1 L 1 1 z ')\r\n\r\nentityTypes =\r\n\tsmoke: class SmokeScreen\r\n\t\tname: 'smoke'\r\n\t\tconstructor: (@game, data) ->\r\n\t\t\t@ctx = @game.ctx\r\n\t\t\t@radius = data.data.radius\r\n\t\t\t@color = 'rgba(255,255,255,0.1)'\r\n\r\n\t\tdraw: ->\r\n\t\t\tif @points?\r\n\t\t\t\t@ctx.save()\r\n\t\t\t\t@ctx.fillStyle = @color\r\n\t\t\t\tfor [x,y] in @points\r\n\t\t\t\t\tx = @game.getDrawX(x)\r\n\t\t\t\t\ty = @game.getDrawY(y)\r\n\r\n\t\t\t\t\t@ctx.beginPath()\r\n\t\t\t\t\t@ctx.arc(x, y, @radius, 0, Math.PI*2)\r\n\t\t\t\t\t@ctx.fill()\r\n\t\t\t\t@ctx.restore()\r\n\r\n\t\tupdate: (data) ->\r\n\t\t\t@points = data.data\r\n\r\n\tshot: class Shot\r\n\t\tname: 'shot'\r\n\t\tconstructor: (@game, data) ->\r\n\t\t\t@ctx = @game.ctx\r\n\t\t\t@data = data.data\r\n\t\t\t@startTime = performance.now()/1000\r\n\t\t\t\r\n\t\tdraw: ->\r\n\t\t\t#offset = @game.mapHeight*(70/800)\r\n\t\t\tx0 = @game.getDrawX(@data.origin[0])\r\n\t\t\ty0 = @game.getDrawY(@data.origin[2])\r\n\t\t\tx1 = @game.getDrawX(@data.target[0])\r\n\t\t\ty1 = @game.getDrawY(@data.target[2])\r\n\r\n\t\t\txd = @data.dir[0]\r\n\t\t\tyd = -@data.dir[2]\r\n\t\t\tl = Math.sqrt(xd*xd + yd*yd)\r\n\t\t\txd/=l\r\n\t\t\tyd/=l\r\n\t\t\tdist = @game.toMapDim(@data.distance)\r\n\r\n\t\t\t###\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.strokeStyle = 'red'\r\n\t\t\t#@ctx.strokeStyle = 'rgba(255,255,255,0.1)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x0, y0+2)\r\n\t\t\t@ctx.lineTo(x1, y1+2)\r\n\t\t\t@ctx.stroke()\r\n\t\t\t@ctx.restore()\r\n\t\t\t###\r\n\r\n\t\t\t@ctx.save()\r\n\t\t\t#@ctx.strokeStyle = 'green'\r\n\t\t\t@ctx.strokeStyle = 'rgba(255,255,255,0.1)'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(x0, y0)\r\n\t\t\t@ctx.lineTo(x0+xd*dist, y0+yd*dist)\r\n\t\t\t@ctx.stroke()\r\n\t\t\t@ctx.restore()\r\n\r\n\t\t\tnow = performance.now()/1000\r\n\t\t\tf = (now - @startTime)/(@data.time+0.4)\r\n\t\t\t#x = x0 + xd*dist*f\r\n\t\t\t#y = y0 + yd*dist*f\r\n\t\t\tx = x0*(1-f) + x1*f\r\n\t\t\ty = y0*(1-f) + y1*f\r\n\r\n\t\t\tif @data.type == 'AP'\r\n\t\t\t\t@ctx.fillStyle = '#57aeff'\r\n\t\t\telse\r\n\t\t\t\t@ctx.fillStyle = 'red'\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.arc(x, y, 1, 0, Math.PI*2)\r\n\t\t\t@ctx.fill()\r\n\t\t\t@ctx.fill()\r\n\r\n\t\tupdate: ->\r\n\t\t\tnull\r\n\r\n\ttorpedo: class Torpedo\r\n\t\tname: 'torpedo'\r\n\t\tconstructor: (@game, data) ->\r\n\t\t\t@ctx = @game.ctx\r\n\t\t\t@data = data.data\r\n\t\t\t@startPosition = @position = @data.position\r\n\t\t\t@direction = @data.direction\r\n\t\t\t@speed = @data.speed\r\n\t\t\t@startTime = performance.now()/1000\r\n\r\n\t\t\txd = @direction[0]\r\n\t\t\tyd = @direction[2]\r\n\t\t\tl = Math.sqrt(xd*xd + yd*yd)\r\n\t\t\t@xd = xd/l; @yd = yd/l\r\n\t\t\t@dir = Math.atan2(@xd, @yd)\r\n\r\n\t\t\t@grad= @ctx.createLinearGradient(0, 0, 200, 0);\r\n\t\t\t@grad.addColorStop(0, \"rgba(255,0,0,0.8)\");\r\n\t\t\t@grad.addColorStop(1, \"rgba(255,0,0,0\");\r\n\r\n\t\tdraw: ->\r\n\t\t\tdelta = performance.now()/1000 - @startTime\r\n\r\n\t\t\tx0 = @startPosition[0]\r\n\t\t\ty0 = @startPosition[2]\r\n\r\n\t\t\t#x1 = @game.getDrawX(@position[0])\r\n\t\t\t#y1 = @game.getDrawY(@position[2])\r\n\r\n\t\t\tx2 = @game.getDrawX(x0 + @xd*@speed*delta)\r\n\t\t\ty2 = @game.getDrawY(y0 + @yd*@speed*delta)\r\n\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.translate(x2, y2)\r\n\t\t\t@ctx.rotate(@dir - Math.PI/2)\r\n\t\t\t\r\n\t\t\t@ctx.save()\r\n\t\t\t@ctx.scale(1.5, 1.5)\r\n\t\t\t@ctx.fillStyle = 'red'\r\n\t\t\t@ctx.fill(shapes.torpedo)\r\n\t\t\t@ctx.restore()\r\n\r\n\t\t\t@ctx.strokeStyle = @grad\r\n\t\t\t@ctx.beginPath()\r\n\t\t\t@ctx.moveTo(0,0)\r\n\t\t\t@ctx.lineTo(200, 0)\r\n\t\t\t@ctx.stroke()\r\n\r\n\t\t\t@ctx.restore()\r\n\r\n\t\tupdate: ({data}) ->\r\n\t\t\t@position = data\r\n\r\n\tplane: class Plane\r\n\t\tshapes: [shapes.eye, shapes.bomb, shapes.torpedo, shapes.shots]\r\n\t\tname: 'plane'\r\n\r\n\t\tconstructor: (@game, {data}) ->\r\n\t\t\t@ctx = @game.ctx\r\n\t\t\t@info = data\r\n\r\n\t\tdraw: ->\r\n\t\t\tif @position?\r\n\t\t\t\tx = @game.getDrawX(@position[0])\r\n\t\t\t\ty = @game.getDrawY(@position[2])\r\n\r\n\t\t\t\t@ctx.save()\r\n\t\t\t\tif @info.team == 'ally'\r\n\t\t\t\t\t@ctx.fillStyle = '#45e9af'\r\n\t\t\t\telse\r\n\t\t\t\t\t@ctx.fillStyle = '#ff3615'\r\n\r\n\t\t\t\t@ctx.translate(x, y)\r\n\r\n\t\t\t\t@ctx.save()\r\n\t\t\t\t@ctx.shadowColor = 'rgba(0, 0, 0, 1)'\r\n\t\t\t\t@ctx.shadowBlur = 10\r\n\t\t\t\t@ctx.translate(0, 13)\r\n\t\t\t\t@ctx.scale(2,2)\r\n\t\t\t\t@ctx.fill(@shapes[@info.type])\r\n\t\t\t\t@ctx.restore()\r\n\r\n\t\t\t\t@ctx.scale(1.7, 1.7)\r\n\t\t\t\t@ctx.rotate(@dir - Math.PI/2)\r\n\t\t\t\t@ctx.fill(shapes.plane)\r\n\t\t\t\t@ctx.restore()\r\n\r\n\t\tupdate: ({data}) ->\r\n\t\t\t@position = data.position\r\n\t\t\t@direction = data.direction\r\n\t\t\t@count = data.count\r\n\r\n\t\t\txd = @direction[0]\r\n\t\t\tyd = @direction[2]\r\n\t\t\tl = Math.sqrt(xd*xd + yd*yd)\r\n\t\t\t@xd = xd/l; @yd = yd/l\r\n\t\t\t@dir = Math.atan2(@xd, @yd)\r\n\r\nexports.index = class Entities\r\n\tconstructor: (@game) ->\r\n\t\t@entities = {}\r\n\r\n\tmessage: (data) ->\r\n\t\tswitch data.action\r\n\t\t\twhen 'create'\r\n\t\t\t\t@entities[data.id] = new entityTypes[data.entityType](@game, data)\r\n\t\t\twhen 'update'\r\n\t\t\t\t@entities[data.id].update(data)\r\n\t\t\twhen 'remove'\r\n\t\t\t\tdelete @entities[data.id]\r\n\r\n\tdraw: (type) ->\r\n\t\tfor id, entity of @entities\r\n\t\t\tif entity.name == type\r\n\t\t\t\tentity.draw()\r\n"]},"mtime":1504874269959,"isModule":true}}